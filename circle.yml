machine:
   environment:
     ANDROID_HOME: /usr/local/android-sdk-linux

dependencies:
  pre:
    - openssl aes-256-cbc -d -in assets/build-vars-enc -k $SENS_DATA_KEY >> ~/.circlerc
    - curl -fL https://getcli.jfrog.io | sh
    - chmod +x jfrog
    - cp -r assets/licenses $ANDROID_HOME/

  cache_directories:
    - ~/.android

deployment:
  master:
    branch: master
    commands:
      - cd googlemediaframework && ../gradlew assembleRelease --stacktrace
      - cd sambaplayersdk && ../gradlew assembleRelease --stacktrace
      - assets/publish.sh $BINTRAY_USER $BINTRAY_API_KEY
  
  dev:
    branch: dev
    commands:
      - cd googlemediaframework && ../gradlew assembleRelease --stacktrace
      - cd sambaplayersdk && ../gradlew assembleRelease --stacktrace
      - assets/publish.sh $BINTRAY_USER $BINTRAY_API_KEY dev
